
# Алгоритм

Достоин внимания только модуль **[countypecore](https://github.com/artembirmin/countype/tree/master/countypecore)**. В нем описан алгоритм, вычисляющий вводимые выражения.  
Входной точкой явялется [вот эта](https://github.com/artembirmin/countype/blob/09842309c5a77670ac442693c2c6d5382f71e25c/countypecore/src/main/java/com/incetro/countypecore/calculator/CalculatorImpl.kt#L28C18-L28C38) функция.

Шаги алгоритма:

1. Стандартизация. Фраза приводится к стандартному виду. Например, все слова вида `процент-` заменяются на символ `%`.
2. Поиск функции и шаблона. По приведенной к стандартному виду фразе находим функцию, шаблонам которой соответствует фраза. Также находим шаблон, которому соответствует фраза.
3. Очищение выражения. Извлекаем из фразы только ту ее часть, которая соответствует шаблону. Используя шаблон можно извлечь из фразы только ту ее часть, которая соответствует шаблону. Например, из фразы `я прошел 8450 метров в километрах` будет извлечено `8450 метров в километрах`. То, что окружает вычисляемое выражение никак не влияет на ответ, поэтому можно от этого избавиться.
4. Извлечение строчных представлений аргументов функций (лексемы). Используя шаблон и модифицированную фразу извлекаем из фразы аргументы, которые нужно передать соответствующей функции, и упорядочиваем их. Каждый шаблон помимо самого паттерна содержит то, в каком порядке представлены аргументы в фразах, которые ему соответствуют. Таким образом шаблону `__number __unit в __unit` соответствует порядок аргументов `(1, 2, 3)`, то есть прямой и после извлечения аргументов не нужно менять их порядок. Шаблону `сколько __unit в __number __unit` соответствует порядок аргументов `(3, 1, 2)`.
5. Определение типов аргументов. Используя полученные строчные представления аргументов найдем соответствующие им объекты, в которых содержится полная информация об аргументе.
6. Передача аргументов в функцию.
7. Возврат ответа.

# Приложение

Модуль **[app](https://github.com/artembirmin/countype/tree/master/app)** был написан во времена, когда автор не знал о существовании фреймворка [Moxy](https://github.com/Arello-Mobile/Moxy) для реализации паттерна MVP и немного принебрегал чистотой кода.
